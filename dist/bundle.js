/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(){e=function(){return n};var r,n={},o=Object.prototype,i=o.hasOwnProperty,a="function"==typeof Symbol?Symbol:{},s=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{l({},"")}catch(r){l=function(t,e,r){return t[e]=r}}function h(t,e,n,o){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype);return l(a,"_invoke",function(t,e,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:r,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=S(s,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var u=f(t,e,n);if("normal"===u.type){if(o=n.done?4:2,u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=4,n.method="throw",n.arg=u.arg)}}}(t,n,new j(o||[])),!0),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}n.wrap=h;var d={};function p(){}function y(){}function v(){}var g={};l(g,s,(function(){return this}));var m=Object.getPrototypeOf,w=m&&m(m(P([])));w&&w!==o&&i.call(w,s)&&(g=w);var b=v.prototype=p.prototype=Object.create(g);function k(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function x(e,r){function n(o,a,s,c){var u=f(e[o],e,a);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==t(h)&&i.call(h,"__await")?r.resolve(h.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):r.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,c)}))}c(u.arg)}var o;l(this,"_invoke",(function(t,e){function i(){return new r((function(r,o){n(t,e,r,o)}))}return o=o?o.then(i,i):i()}),!0)}function S(t,e){var n=e.method,o=t.i[n];if(o===r)return e.delegate=null,"throw"===n&&t.i.return&&(e.method="return",e.arg=r,S(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=f(o,t.i,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var a=i.arg;return a?a.done?(e[t.r]=a.value,e.next=t.n,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,d):a:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function E(t){this.tryEntries.push(t)}function O(t){var e=t[4]||{};e.type="normal",e.arg=r,t[4]=e}function j(t){this.tryEntries=[[-1]],t.forEach(E,this),this.reset(!0)}function P(e){if(null!=e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function t(){for(;++o<e.length;)if(i.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=r,t.done=!0,t};return a.next=a}}throw new TypeError(t(e)+" is not iterable")}return y.prototype=v,l(b,"constructor",v),l(v,"constructor",y),y.displayName=l(v,u,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,l(t,u,"GeneratorFunction")),t.prototype=Object.create(b),t},n.awrap=function(t){return{__await:t}},k(x.prototype),l(x.prototype,c,(function(){return this})),n.AsyncIterator=x,n.async=function(t,e,r,o,i){void 0===i&&(i=Promise);var a=new x(h(t,e,r,o),i);return n.isGeneratorFunction(e)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(b),l(b,u,"Generator"),l(b,s,(function(){return this})),l(b,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},n.values=P,j.prototype={constructor:j,reset:function(t){if(this.prev=this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r){a.type="throw",a.arg=t,e.next=r}for(var o=e.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,c=i[1],u=i[2];if(-1===i[0])return n("end"),!1;if(!c&&!u)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<c)return this.method="next",this.arg=r,n(c),!0;if(s<u)return n(u),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],d):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),O(r),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;O(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={i:P(t),r:e,n},"next"===this.method&&(this.arg=r),d}},n}function r(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function n(t){return function(){var e=this,n=arguments;return new Promise((function(o,i){var a=t.apply(e,n);function s(t){r(a,o,i,s,c,"next",t)}function c(t){r(a,o,i,s,c,"throw",t)}s(void 0)}))}}var o,i="stories";function a(){return s.apply(this,arguments)}function s(){return(s=n(e().mark((function t(){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!o){t.next=2;break}return t.abrupt("return",o);case 2:return t.abrupt("return",new Promise((function(t,e){var r=indexedDB.open("myDatabase",1);r.onupgradeneeded=function(t){(o=t.target.result).objectStoreNames.contains(i)||o.createObjectStore(i,{keyPath:"id"})},r.onsuccess=function(e){o=e.target.result,t(o)},r.onerror=function(t){e("Gagal membuka database: ".concat(t.target.errorCode))}})));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function c(t){return u.apply(this,arguments)}function u(){return(u=n(e().mark((function r(n){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Menyimpan data:",n),o){e.next=4;break}return e.next=4,a();case 4:if(n&&"object"===t(n)){e.next=6;break}return e.abrupt("return",Promise.reject("Data tidak valid: bukan objek"));case 6:if(n.id){e.next=9;break}return console.error("Data tidak memiliki key 'id'. Data yang diterima:",n),e.abrupt("return",Promise.reject("Data tidak memiliki id yang valid"));case 9:return e.abrupt("return",new Promise((function(t,e){var r=o.transaction([i],"readwrite").objectStore(i).put(n);r.onsuccess=function(){return t(!0)},r.onerror=function(t){console.error("Gagal menyimpan data ke IndexedDB:",t.target.error),e("Gagal menyimpan data: ".concat(t.target.error))}})));case 10:case"end":return e.stop()}}),r)})))).apply(this,arguments)}function l(t){return h.apply(this,arguments)}function h(){return(h=n(e().mark((function t(r){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o){t.next=3;break}return t.next=3,a();case 3:if(r){t.next=5;break}return t.abrupt("return",Promise.reject("ID tidak valid"));case 5:return t.abrupt("return",new Promise((function(t,e){var n=o.transaction([i],"readwrite").objectStore(i).delete(r);n.onsuccess=function(){return t(!0)},n.onerror=function(){return e("Gagal menghapus data")}})));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function f(t){return d.apply(this,arguments)}function d(){return(d=n(e().mark((function t(r){return e().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o){t.next=3;break}return t.next=3,a();case 3:if(r){t.next=5;break}return t.abrupt("return",Promise.reject("ID tidak valid"));case 5:return t.abrupt("return",new Promise((function(t,e){var n=o.transaction([i],"readonly").objectStore(i).get(r);n.onsuccess=function(){n.result?t(n.result):e("Data tidak ditemukan")},n.onerror=function(){return e("Gagal mengambil data")}})));case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function y(){y=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return c(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=S(s,n);if(c){if(c===h)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var u=l(e,r,n);if("normal"===u.type){if(o=n.done?4:2,u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=4,n.method="throw",n.arg=u.arg)}}}(e,n,new j(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var h={};function f(){}function d(){}function v(){}var g={};c(g,i,(function(){return this}));var m=Object.getPrototypeOf,w=m&&m(m(P([])));w&&w!==r&&n.call(w,i)&&(g=w);var b=v.prototype=f.prototype=Object.create(g);function k(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function x(t,e){function r(o,i,a,s){var c=l(t[o],t,i);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==p(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,s)}))}s(c.arg)}var o;c(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function S(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,S(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function E(t){this.tryEntries.push(t)}function O(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function j(t){this.tryEntries=[[-1]],t.forEach(E,this),this.reset(!0)}function P(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(p(e)+" is not iterable")}return d.prototype=v,c(b,"constructor",v),c(v,"constructor",d),d.displayName=c(v,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,c(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},k(x.prototype),c(x.prototype,a,(function(){return this})),e.AsyncIterator=x,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new x(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(b),c(b,s,"Generator"),c(b,i,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=P,j.prototype={constructor:j,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,c=i[1],u=i[2];if(-1===i[0])return n("end"),!1;if(!c&&!u)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<c)return this.method="next",this.arg=t,n(c),!0;if(s<u)return n(u),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),O(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;O(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:P(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function v(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function g(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?v(Object(r),!0).forEach((function(e){m(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function m(t,e,r){return(e=x(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function w(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function b(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){w(i,n,o,a,s,"next",t)}function s(t){w(i,n,o,a,s,"throw",t)}a(void 0)}))}}function k(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,x(n.key),n)}}function x(t){var e=function(t){if("object"!=p(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=p(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==p(e)?e:e+""}const S=function(){return t=function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.token=localStorage.getItem("authToken")||"",this.stories=[],this.isOnline=navigator.onLine,window.addEventListener("online",(function(){e.isOnline=!0,console.log("Anda kembali online")})),window.addEventListener("offline",(function(){e.isOnline=!1,console.log("Anda sedang offline")}))},e=[{key:"_fetchWithOfflineFallback",value:(m=b(y().mark((function t(e,r,n){var o,i,a,s,u;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.isOnline){t.next=3;break}throw new Error("offline");case 3:return t.next=5,fetch(e,r);case 5:if((o=t.sent).ok){t.next=8;break}throw new Error("API request failed");case 8:return t.next=10,o.json();case 10:if(i=t.sent,!n||i.error){t.next=14;break}return t.next=14,c({id:n,data:{listStory:i.listStory||(null===(a=i.data)||void 0===a?void 0:a.listStory)||null,detailStory:i.story||null,timestamp:(new Date).toISOString()}});case 14:return t.abrupt("return",i);case 17:if(t.prev=17,t.t0=t.catch(0),"offline"!==t.t0.message||!n){t.next=30;break}return t.next=22,f(n);case 22:if(!(s=t.sent)){t.next=29;break}if(u=new Date(s.timestamp),!((new Date-u)/1e3/3600>24)){t.next=28;break}throw new Error("Cached data expired");case 28:return t.abrupt("return",g(g({},s.data),{},{fromCache:!0,message:"Anda sedang offline. Menampilkan data terakhir yang tersimpan."}));case 29:throw new Error("No cached data available");case 30:throw t.t0;case 31:case"end":return t.stop()}}),t,this,[[0,17]])}))),function(t,e,r){return m.apply(this,arguments)})},{key:"getOfflineStories",value:(v=b(y().mark((function t(){var e,r,n,o,i=arguments;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=i.length>1&&void 0!==i[1]?i[1]:10,r=i.length>2&&void 0!==i[2]?i[2]:0,n="stories-page".concat(i.length>0&&void 0!==i[0]?i[0]:1,"-size").concat(e,"-loc").concat(r),t.next=6,f(n);case 6:if(!(o=t.sent)||!o.data.listStory){t.next=9;break}return t.abrupt("return",o.data.listStory.map((function(t){return g(g({},t),{},{fromCache:!0,cacheKey:n})})));case 9:return t.abrupt("return",[]);case 10:case"end":return t.stop()}}),t)}))),function(){return v.apply(this,arguments)})},{key:"register",value:(p=b(y().mark((function t(e,r,n){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._fetchWithOfflineFallback("https://story-api.dicoding.dev/v1/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:r,password:n})}));case 1:case"end":return t.stop()}}),t,this)}))),function(t,e,r){return p.apply(this,arguments)})},{key:"login",value:(d=b(y().mark((function t(e,r){var n;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._fetchWithOfflineFallback("https://story-api.dicoding.dev/v1/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r})});case 2:return(n=t.sent).error||(this.token=n.loginResult.token,localStorage.setItem("authToken",this.token)),t.abrupt("return",n);case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return d.apply(this,arguments)})},{key:"addStory",value:(h=b(y().mark((function t(e,r,n,o){var i,a;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isOnline){t.next=2;break}return t.abrupt("return",{error:!0,message:"Cannot add story while offline. Please connect to the internet."});case 2:return(i=new FormData).append("description",e),i.append("photo",r),n&&o&&(i.append("lat",n),i.append("lon",o)),t.next=8,this._fetchWithOfflineFallback("https://story-api.dicoding.dev/v1/stories",{method:"POST",headers:{Authorization:"Bearer "+this.token},body:i},"latestStories");case 8:return a=t.sent,t.abrupt("return",a);case 10:case"end":return t.stop()}}),t,this)}))),function(t,e,r,n){return h.apply(this,arguments)})},{key:"getStories",value:(u=b(y().mark((function t(){var e,r,n,o,i,a,s,c=arguments;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=c.length>1&&void 0!==c[1]?c[1]:10,n=c.length>2&&void 0!==c[2]?c[2]:0,o="stories-page".concat(e=c.length>0&&void 0!==c[0]?c[0]:1,"-size").concat(r,"-loc").concat(n),this.isOnline){t.next=11;break}return console.warn("ðŸ“´ Anda offline. Memuat cerita dari cache melalui getOfflineStories()"),t.next=8,this.getOfflineStories();case 8:return i=t.sent,this.stories=i,t.abrupt("return",{error:!1,listStory:i,fromCache:!0,message:"Anda sedang offline. Menampilkan cerita yang disimpan di cache."});case 11:return t.next=13,this._fetchWithOfflineFallback("https://story-api.dicoding.dev/v1/stories?page=".concat(e,"&size=").concat(r,"&location=").concat(n),{headers:{Authorization:"Bearer "+this.token}},o);case 13:return(a=t.sent).error||(this.stories=a.listStory||(null===(s=a.data)||void 0===s?void 0:s.listStory)||[]),t.abrupt("return",a);case 16:case"end":return t.stop()}}),t,this)}))),function(){return u.apply(this,arguments)})},{key:"getStoryDetail",value:(s=b(y().mark((function t(e){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._fetchWithOfflineFallback("https://story-api.dicoding.dev/v1/stories/".concat(e),{headers:{Authorization:"Bearer "+this.token}},"story-".concat(e)));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return s.apply(this,arguments)})},{key:"subscribeToNotification",value:(a=b(y().mark((function t(e){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._fetchWithOfflineFallback("https://story-api.dicoding.dev/v1/notifications/subscribe",{method:"POST",headers:{Authorization:"Bearer ".concat(this.token),"Content-Type":"application/json"},body:JSON.stringify(e)}));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return a.apply(this,arguments)})},{key:"unsubscribeFromNotification",value:(i=b(y().mark((function t(e){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this._fetchWithOfflineFallback("https://story-api.dicoding.dev/v1/notifications/subscribe",{method:"DELETE",headers:{Authorization:"Bearer ".concat(this.token),"Content-Type":"application/json"},body:JSON.stringify({endpoint:e.endpoint})}));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"syncLocalData",value:(o=b(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.isOnline&&console.log("Syncing local data...");case 1:case"end":return t.stop()}}),t,this)}))),function(){return o.apply(this,arguments)})},{key:"deleteOneStoryFromCache",value:(n=b(y().mark((function t(e,r){var n,o;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e&&r){t.next=3;break}throw new Error("Cache key dan story ID tidak boleh kosong");case 3:return t.next=5,f(e);case 5:if((n=t.sent)&&n.data&&Array.isArray(n.data.listStory)){t.next=8;break}throw new Error("Data cache tidak ditemukan atau format tidak valid");case 8:if(o=n.data.listStory.length,n.data.listStory=n.data.listStory.filter((function(t){return t.id!==r})),n.data.listStory.length!==o){t.next=12;break}throw new Error("Cerita tidak ditemukan dalam cache");case 12:return t.next=14,c({id:e,data:n.data});case 14:return console.log("Cerita dengan ID ".concat(r,' berhasil dihapus dari cache "').concat(e,'".')),t.abrupt("return",{success:!0,message:"Cerita berhasil dihapus dari cache."});case 18:return t.prev=18,t.t0=t.catch(0),console.error("Gagal menghapus cerita dari cache:",t.t0),t.abrupt("return",{success:!1,message:t.t0.message||"Gagal menghapus cerita dari cache"});case 22:case"end":return t.stop()}}),t,null,[[0,18]])}))),function(t,e){return n.apply(this,arguments)})},{key:"deleteOfflineStory",value:(r=b(y().mark((function t(e){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e){t.next=3;break}throw new Error("Cache key tidak valid");case 3:return t.next=5,l(e);case 5:return console.log('Cerita offline dengan key "'.concat(e,'" telah dihapus.')),t.abrupt("return",{success:!0,message:'Cerita offline dengan key "'.concat(e,'" berhasil dihapus.')});case 9:return t.prev=9,t.t0=t.catch(0),console.error("Gagal menghapus data offline:",t.t0),t.abrupt("return",{success:!1,message:t.t0.message||"Gagal menghapus data offline."});case 13:case"end":return t.stop()}}),t,null,[[0,9]])}))),function(t){return r.apply(this,arguments)})}],e&&k(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,s,u,h,d,p,v,m}();function E(t){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},E(t)}function O(){O=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return c(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=k(s,n);if(c){if(c===h)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var u=l(e,r,n);if("normal"===u.type){if(o=n.done?4:2,u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=4,n.method="throw",n.arg=u.arg)}}}(e,n,new j(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var h={};function f(){}function d(){}function p(){}var y={};c(y,i,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(P([])));g&&g!==r&&n.call(g,i)&&(y=g);var m=p.prototype=f.prototype=Object.create(y);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var c=l(t[o],t,i);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==E(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,s)}))}s(c.arg)}var o;c(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function k(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function x(t){this.tryEntries.push(t)}function S(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function j(t){this.tryEntries=[[-1]],t.forEach(x,this),this.reset(!0)}function P(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(E(e)+" is not iterable")}return d.prototype=p,c(m,"constructor",p),c(p,"constructor",d),d.displayName=c(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),c(m,s,"Generator"),c(m,i,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=P,j.prototype={constructor:j,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,c=i[1],u=i[2];if(-1===i[0])return n("end"),!1;if(!c&&!u)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<c)return this.method="next",this.arg=t,n(c),!0;if(s<u)return n(u),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),S(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;S(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:P(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function j(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function P(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){j(i,n,o,a,s,"next",t)}function s(t){j(i,n,o,a,s,"throw",t)}a(void 0)}))}}function F(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,T(n.key),n)}}function T(t){var e=function(t){if("object"!=E(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=E(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==E(e)?e:e+""}const _=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.registerForm=document.getElementById("registerForm"),this.loginForm=document.getElementById("loginForm"),this.storyForm=document.getElementById("storyForm"),this.storiesDiv=document.getElementById("stories"),this.storySection=document.getElementById("storySection"),this.authSection=document.getElementById("authSection"),this.takePhotoButton=document.getElementById("takePhoto"),this.photoInput=document.getElementById("photo"),this.video=document.getElementById("video"),this.preview=document.getElementById("preview"),this.countdownDiv=document.getElementById("countdown"),this.retakePhotoButton=document.getElementById("retakePhotoButton"),this.loadStoriesButton=document.getElementById("loadStoriesButton"),this.offlineIndicator=this.createOfflineIndicator(),this.storyContainer=this.storiesDiv,this.feedbackDiv=document.createElement("div"),this.feedbackDiv.setAttribute("role","alert"),this.feedbackDiv.setAttribute("aria-live","assertive"),document.body.appendChild(this.feedbackDiv),this.map=null,this.latitude=null,this.longitude=null,this.stream=null,this.currentMarkers=[]},e=[{key:"setPresenter",value:function(t){this.presenter=t}},{key:"createOfflineIndicator",value:function(){var t=document.createElement("div");return t.id="offline-indicator",t.style.position="fixed",t.style.bottom="20px",t.style.right="20px",t.style.padding="10px 15px",t.style.backgroundColor="#ff9800",t.style.color="white",t.style.borderRadius="4px",t.style.boxShadow="0 2px 5px rgba(0,0,0,0.2)",t.style.zIndex="1000",t.style.display="none",t.textContent="Anda sedang offline",document.body.appendChild(t),t}},{key:"updateOnlineStatus",value:function(t){this.offlineIndicator.style.display=t?"none":"block"}},{key:"initMap",value:function(){var t=this;this.map=L.map("map").setView([-6.200001,106.816666],5),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19,attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}).addTo(this.map),L.tileLayer("",{maxZoom:19,attribution:"Offline mode"}).addTo(this.map),this.map.on("click",(function(e){t.latitude=e.latlng.lat,t.longitude=e.latlng.lng,t.clearMarkers();var r=L.marker([t.latitude,t.longitude]).addTo(t.map);t.currentMarkers.push(r),r.bindPopup("Titik yang dipilih: Latitude: ".concat(t.latitude,", Longitude: ").concat(t.longitude)).openPopup(),t.showFeedback("Koordinat yang dipilih: ".concat(t.latitude,", ").concat(t.longitude),"info")}))}},{key:"clearMarkers",value:function(){var t=this;this.currentMarkers.forEach((function(e){return t.map.removeLayer(e)})),this.currentMarkers=[]}},{key:"showNotificationMessage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",r=document.createElement("div");r.className="notification ".concat(e),r.innerText=t;var n={position:"fixed",top:"20px",right:"20px",padding:"10px 15px",borderRadius:"4px",boxShadow:"0 2px 5px rgba(0,0,0,0.2)",zIndex:"1000",transition:"opacity 0.5s ease-in-out",color:"white"};n.backgroundColor="error"===e?"#f44336":"success"===e?"#4caf50":"warning"===e?"#ff9800":"#2196f3",Object.assign(r.style,n),document.body.appendChild(r),setTimeout((function(){r.style.opacity="0",setTimeout((function(){r.remove()}),500)}),3e3)}},{key:"showFeedback",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";this.showNotificationMessage(t,e),this.feedbackDiv.textContent=t,this.feedbackDiv.className=e}},{key:"showLoading",value:function(t){(document.getElementById("loading")||this.createLoadingElement()).style.display=t?"block":"none"}},{key:"createLoadingElement",value:function(){var t=document.createElement("div");t.id="loading",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0,0,0,0.5)",t.style.display="none",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex="9999";var e=document.createElement("div");return e.className="spinner",e.style.border="4px solid rgba(255,255,255,0.3)",e.style.borderRadius="50%",e.style.borderTop="4px solid #fff",e.style.width="40px",e.style.height="40px",e.style.animation="spin 1s linear infinite",t.appendChild(e),document.body.appendChild(t),t}},{key:"displayStories",value:function(t){var e=this;this.storiesDiv.innerHTML="",this.clearMarkers(),t&&0!==t.length?t.forEach((function(t){var r,n;console.log("Mengecek properti story:",t);var o=document.createElement("div");o.classList.add("story-item"),o.dataset.storyId=t.id;var i=null!==(r=t.lat)&&void 0!==r?r:null,a=null!==(n=t.lon)&&void 0!==n?n:null,s=t.createdAt?new Date(t.createdAt).toLocaleString():"Tanggal tidak tersedia";if(o.innerHTML="\n        <h3>".concat(e.escapeHTML(t.name),"</h3>\n        <p>").concat(e.escapeHTML(t.description),"</p>\n        ").concat(i&&a?"<p><small>Lokasi: ".concat(i,", ").concat(a,"</small></p>"):"",'\n        <img src="').concat(t.photoUrl,'" alt="Gambar cerita oleh ').concat(e.escapeHTML(t.name),'" loading="lazy">\n        <p><small>Dibuat pada: ').concat(s,"</small></p>\n        ").concat(t.fromCache?'\n          <div class="cache-badge">Dari Cache</div>\n          <button class="delete-offline-btn"\n                  data-cache-key="'.concat(t.cacheKey,'"\n                  data-story-id="').concat(t.id,'">\n            Hapus\n          </button>\n        '):"","\n      "),t.fromCache){var c=o.querySelector(".delete-offline-btn");c&&c.addEventListener("click",(function(t){t.stopPropagation();var r=c.dataset.cacheKey,n=c.dataset.storyId;console.log("Presenter di event handler:",e.presenter),e.presenter.handleDeleteOfflineStory(r,n)}))}if(o.addEventListener("mouseenter",(function(){o.classList.add("hover-effect")})),o.addEventListener("mouseleave",(function(){o.classList.remove("hover-effect")})),o.querySelector("img").addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation()})),o.addEventListener("click",(function(){e.showFeedback("Cerita: ".concat(t.name," - ").concat(t.description)),e.showStoryDetail(t),console.log("Detail Story:\n"+JSON.stringify(t,null,2)),o.classList.add("popup-effect"),setTimeout((function(){o.classList.remove("popup-effect")}),1500)})),e.storiesDiv.appendChild(o),i&&a){var u=L.marker([i,a]).addTo(e.map);u.bindPopup("<b>".concat(e.escapeHTML(t.name),"</b><br>").concat(e.escapeHTML(t.description))),e.currentMarkers.push(u)}})):this.storiesDiv.innerHTML='<p class="no-stories">Tidak ada cerita yang tersedia</p>'}},{key:"showStoryDetail",value:function(t){var e,r,n=this,o=document.getElementById("story-modal")||this.createModal(),i=null!==(e=t.lat)&&void 0!==e?e:null,a=null!==(r=t.lon)&&void 0!==r?r:null,s=t.createdAt?new Date(t.createdAt).toLocaleString():"Tanggal tidak tersedia";if(o.innerHTML='\n      <div class="modal-content">\n        <span class="close-modal">&times;</span>\n        <h2>'.concat(this.escapeHTML(t.name),'</h2>\n        <img src="').concat(t.photoUrl,'" alt="Gambar cerita oleh ').concat(this.escapeHTML(t.name),'">\n        <p>').concat(this.escapeHTML(t.description),"</p>\n        ").concat(i&&a?"<p><small>Lokasi: ".concat(i,", ").concat(a,"</small></p>"):"","\n        <p><small>Dibuat pada: ").concat(s,"</small></p>\n        ").concat(t.fromCache?'\n          <div class="cache-badge">Dari Cache</div>\n          <button class="delete-offline-btn"\n                  data-cache-key="'.concat(t.cacheKey,'"\n                  data-story-id="').concat(t.id,'">\n            Hapus\n          </button>\n        '):"","\n      </div>\n    "),o.style.display="block",o.querySelector(".close-modal").addEventListener("click",(function(){o.style.display="none"})),window.addEventListener("click",(function(t){t.target===o&&(o.style.display="none")})),t.fromCache){var c=o.querySelector(".delete-offline-btn");c&&c.addEventListener("click",(function(t){t.stopPropagation();var e=c.dataset.cacheKey,r=c.dataset.storyId;console.log("Presenter di event handler:",n.presenter),n.presenter.handleDeleteOfflineStory(e,r),o.style.display="none"}))}}},{key:"escapeHTML",value:function(t){return String(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}},{key:"createModal",value:function(){var t=document.createElement("div");return t.id="story-modal",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.display="none",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex="10000",t.style.padding="20px",t.style.overflowY="auto",document.body.appendChild(t),t}},{key:"resetAddStoryForm",value:function(){this.storyForm.reset(),this.preview.src="",this.preview.style.display="none",this.retakePhotoButton.style.display="none",this.takePhotoButton.style.display="inline-block",this.clearMarkers(),this.latitude=null,this.longitude=null}},{key:"deleteOfflineStory",value:function(t){try{localStorage.removeItem(t),this.showFeedback("Cerita offline berhasil dihapus","success"),this.removeStoryFromDisplay(t)}catch(t){this.showFeedback("Gagal menghapus cerita offline","error")}}},{key:"removeStoryFromDisplay",value:function(t){var e=document.querySelector('[data-cache-key="'.concat(t,'"]'));e&&e.remove()}},{key:"bindRegister",value:function(t){this.registerForm.addEventListener("submit",function(){var e=P(O().mark((function e(r){var n,o,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),n=document.getElementById("name").value,o=document.getElementById("email").value,i=document.getElementById("password").value,e.next=6,t(n,o,i);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"bindLogin",value:function(t){this.loginForm.addEventListener("submit",function(){var e=P(O().mark((function e(r){var n,o;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),n=document.getElementById("loginEmail").value,o=document.getElementById("loginPassword").value,e.next=5,t(n,o);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"bindLogout",value:function(t){var e=document.getElementById("logoutButton");e&&e.addEventListener("click",t)}},{key:"bindAddStory",value:function(t){var e=this;this.storyForm.addEventListener("submit",function(){var r=P(O().mark((function r(n){var o,i;return O().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n.preventDefault(),o=document.getElementById("description").value,i=e.photoInput.files[0],r.next=5,t(o,i,e.latitude,e.longitude);case 5:case"end":return r.stop()}}),r)})));return function(t){return r.apply(this,arguments)}}())}},{key:"bindLoadStories",value:function(t){this.loadStoriesButton.addEventListener("click",(function(){var e=parseInt(document.getElementById("page").value),r=parseInt(document.getElementById("size").value),n=parseInt(document.getElementById("location").value);t(e,r,n)}))}},{key:"bindTakePhoto",value:function(){var t=this;this.takePhotoButton.addEventListener("click",P(O().mark((function e(){var r,n;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.takePhotoButton.style.display="none",t.preview.style.display="none",t.retakePhotoButton.style.display="none",t.stream){e.next=10;break}return e.next=6,navigator.mediaDevices.getUserMedia({video:!0});case 6:return t.stream=e.sent,t.video.srcObject=t.stream,e.next=10,t.video.play();case 10:t.video.style.display="block",t.countdownDiv.style.display="block",t.countdownDiv.textContent="3",r=3,n=setInterval((function(){if(r--,t.countdownDiv.textContent=r>0?r:"",0===r){clearInterval(n),t.countdownDiv.style.display="none",t.video.style.display="none";var e=document.createElement("canvas");e.width=t.video.videoWidth,e.height=t.video.videoHeight,e.getContext("2d").drawImage(t.video,0,0,e.width,e.height),t.preview.src=e.toDataURL("image/jpeg"),t.preview.style.display="block",e.toBlob((function(e){var r=new File([e],"photo.jpg",{type:"image/jpeg"}),n=new DataTransfer;n.items.add(r),t.photoInput.files=n.files})),t.stream.getTracks().forEach((function(t){return t.stop()})),t.stream=null,t.retakePhotoButton.style.display="inline-block"}}),1e3);case 15:case"end":return e.stop()}}),e)})))),this.retakePhotoButton.addEventListener("click",(function(){t.preview.style.display="none",t.retakePhotoButton.style.display="none",t.takePhotoButton.style.display="inline-block"}))}},{key:"bindHashChange",value:function(t){window.addEventListener("hashchange",(function(){t()})),window.addEventListener("DOMContentLoaded",(function(){t()}))}},{key:"bindFetchStoryDetail",value:function(t){this.storiesDiv.addEventListener("click",(function(e){var r=e.target.closest(".story-item");if(r){var n=r.getAttribute("data-story-id");t(n)}}))}},{key:"bindDeleteStory",value:function(t){this.onDeleteCallback=t}},{key:"bindDeleteOfflineStory",value:function(t){this.storyContainer.addEventListener("click",(function(e){if(e.target.classList.contains("delete-offline-btn")){var r=e.target.dataset.cacheKey;t(r)}}))}},{key:"showSection",value:function(t){var e=this;document.startViewTransition?document.startViewTransition((function(){e.authSection.style.display="auth"===t?"block":"none",e.storySection.style.display="story"===t?"block":"none"})):(this.authSection.style.display="auth"===t?"block":"none",this.storySection.style.display="story"===t?"block":"none")}},{key:"showAuthSection",value:function(){this.authSection&&(this.authSection.style.display="block"),this.storySection&&(this.storySection.style.display="none")}},{key:"showStorySection",value:function(){this.authSection&&(this.authSection.style.display="none"),this.storySection&&(this.storySection.style.display="block")}},{key:"fadeIn",value:(n=P(O().mark((function t(e){return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.style.opacity=0,e.style.transition="opacity 0.5s ease-in",e.style.opacity=1,t.next=5,new Promise((function(t){return setTimeout(t,500)}));case 5:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)})},{key:"fadeOut",value:(r=P(O().mark((function t(e){return O().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.style.opacity=1,e.style.transition="opacity 0.5s ease-out",e.style.opacity=0,t.next=5,new Promise((function(t){return setTimeout(t,500)}));case 5:case"end":return t.stop()}}),t)}))),function(t){return r.apply(this,arguments)})}],e&&F(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n}();function I(t){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},I(t)}function D(){D=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return c(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=k(s,n);if(c){if(c===h)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var u=l(e,r,n);if("normal"===u.type){if(o=n.done?4:2,u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=4,n.method="throw",n.arg=u.arg)}}}(e,n,new E(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var h={};function f(){}function d(){}function p(){}var y={};c(y,i,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(O([])));g&&g!==r&&n.call(g,i)&&(y=g);var m=p.prototype=f.prototype=Object.create(y);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var c=l(t[o],t,i);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==I(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,s)}))}s(c.arg)}var o;c(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function k(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function x(t){this.tryEntries.push(t)}function S(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function E(t){this.tryEntries=[[-1]],t.forEach(x,this),this.reset(!0)}function O(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(I(e)+" is not iterable")}return d.prototype=p,c(m,"constructor",p),c(p,"constructor",d),d.displayName=c(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),c(m,s,"Generator"),c(m,i,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=O,E.prototype={constructor:E,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,c=i[1],u=i[2];if(-1===i[0])return n("end"),!1;if(!c&&!u)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<c)return this.method="next",this.arg=t,n(c),!0;if(s<u)return n(u),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),S(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;S(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:O(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function C(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function G(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){C(i,n,o,a,s,"next",t)}function s(t){C(i,n,o,a,s,"throw",t)}a(void 0)}))}}function B(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function M(t){return btoa(String.fromCharCode.apply(null,new Uint8Array(t)))}var A=new S;function N(t){return H.apply(this,arguments)}function H(){return(H=G(D().mark((function t(e){var r,n,o,i;return D().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("initPushManager called"),"serviceWorker"in navigator){t.next=5;break}return alert("Service Worker not supported in this browser."),console.error("Service Worker not supported"),t.abrupt("return");case 5:return t.prev=5,t.next=8,navigator.serviceWorker.register("./sw.js");case 8:return r=t.sent,console.log("Service Worker registered:",r),t.next=12,r.pushManager.getSubscription();case 12:if(n=t.sent){t.next=20;break}return t.next=16,r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:(s="BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk",void 0,void 0,c=(s+"=".repeat(1)).replace(/-/g,"+").replace(/_/g,"/"),u=atob(c),new Uint8Array((a=u,function(t){if(Array.isArray(t))return B(t)}(a)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(a)||function(t,e){if(t){if("string"==typeof t)return B(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?B(t,e):void 0}}(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(t){return t.charCodeAt(0)}))))});case 16:n=t.sent,console.log("New push subscription:",n),t.next=21;break;case 20:console.log("Existing push subscription:",n);case 21:return o={endpoint:n.endpoint,keys:{p256dh:M(n.getKey("p256dh")),auth:M(n.getKey("auth"))}},A.token=e,t.next=25,A.subscribeToNotification(o);case 25:i=t.sent,console.log("Subscribed response:",i),alert("Subscribed Successfully!"),t.next=34;break;case 30:t.prev=30,t.t0=t.catch(5),console.error("Error during subscribe:",t.t0),alert("Subscription failed: "+t.t0.message);case 34:case"end":return t.stop()}var a,s,c,u}),t,null,[[5,30]])})))).apply(this,arguments)}function W(t){return z.apply(this,arguments)}function z(){return(z=G(D().mark((function t(e){var r,n,o,i;return D().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("unsubscribePushManager called"),t.prev=1,t.next=4,navigator.serviceWorker.ready;case 4:return r=t.sent,console.log("Service Worker ready:",r),t.next=8,r.pushManager.getSubscription();case 8:if(!(n=t.sent)){t.next=22;break}return o={endpoint:n.endpoint},A.token=e,t.next=14,A.unsubscribeFromNotification(o);case 14:return i=t.sent,console.log("Unsubscribe response:",i),t.next=18,n.unsubscribe();case 18:console.log("Unsubscribed from push service"),alert("Unsubscribed Successfully!"),t.next=24;break;case 22:alert("No active subscription found."),console.log("No subscription found to unsubscribe.");case 24:t.next=30;break;case 26:t.prev=26,t.t0=t.catch(1),console.error("Error during unsubscribe:",t.t0),alert("Unsubscribe failed: "+t.t0.message);case 30:case"end":return t.stop()}}),t,null,[[1,26]])})))).apply(this,arguments)}var U=null,R=null;function K(t){var e=document.getElementById("subscribeButton"),r=document.getElementById("unsubscribeButton");if(!e||!r)return console.error("Subscribe or Unsubscribe button not found in DOM."),void alert("Subscription buttons missing in page.");U&&e.removeEventListener("click",U),R&&r.removeEventListener("click",R),U=function(){var e=G(D().mark((function e(){return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Subscribe button clicked"),e.next=3,N(t);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),R=function(){var e=G(D().mark((function e(){return D().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Unsubscribe button clicked"),e.next=3,W(t);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.addEventListener("click",U),r.addEventListener("click",R)}function q(t){return q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},q(t)}function J(){J=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function c(t,e,r,n){return Object.defineProperty(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n})}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function u(e,r,n,o){var i=r&&r.prototype instanceof f?r:f,a=Object.create(i.prototype);return c(a,"_invoke",function(e,r,n){var o=1;return function(i,a){if(3===o)throw Error("Generator is already running");if(4===o){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var c=k(s,n);if(c){if(c===h)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(1===o)throw o=4,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=3;var u=l(e,r,n);if("normal"===u.type){if(o=n.done?4:2,u.arg===h)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=4,n.method="throw",n.arg=u.arg)}}}(e,n,new E(o||[])),!0),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var h={};function f(){}function d(){}function p(){}var y={};c(y,i,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(O([])));g&&g!==r&&n.call(g,i)&&(y=g);var m=p.prototype=f.prototype=Object.create(y);function w(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function b(t,e){function r(o,i,a,s){var c=l(t[o],t,i);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==q(h)&&n.call(h,"__await")?e.resolve(h.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(h).then((function(t){u.value=t,a(u)}),(function(t){return r("throw",t,a,s)}))}s(c.arg)}var o;c(this,"_invoke",(function(t,n){function i(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(i,i):i()}),!0)}function k(e,r){var n=r.method,o=e.i[n];if(o===t)return r.delegate=null,"throw"===n&&e.i.return&&(r.method="return",r.arg=t,k(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),h;var i=l(o,e.i,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,h;var a=i.arg;return a?a.done?(r[e.r]=a.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function x(t){this.tryEntries.push(t)}function S(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function E(t){this.tryEntries=[[-1]],t.forEach(x,this),this.reset(!0)}function O(e){if(null!=e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(q(e)+" is not iterable")}return d.prototype=p,c(m,"constructor",p),c(p,"constructor",d),d.displayName=c(p,s,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===d||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,c(t,s,"GeneratorFunction")),t.prototype=Object.create(m),t},e.awrap=function(t){return{__await:t}},w(b.prototype),c(b.prototype,a,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new b(u(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(m),c(m,s,"Generator"),c(m,i,(function(){return this})),c(m,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},e.values=O,E.prototype={constructor:E,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(S),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(t){a.type="throw",a.arg=e,r.next=t}for(var o=r.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i[4],s=this.prev,c=i[1],u=i[2];if(-1===i[0])return n("end"),!1;if(!c&&!u)throw Error("try statement without catch or finally");if(null!=i[0]&&i[0]<=s){if(s<c)return this.method="next",this.arg=t,n(c),!0;if(s<u)return n(u),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n[0]>-1&&n[0]<=this.prev&&this.prev<n[2]){var o=n;break}}o&&("break"===t||"continue"===t)&&o[0]<=e&&e<=o[2]&&(o=null);var i=o?o[4]:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o[2],h):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),S(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var n=r[4];if("throw"===n.type){var o=n.arg;S(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={i:O(e),r,n},"next"===this.method&&(this.arg=t),h}},e}function Y(t,e,r,n,o,i,a){try{var s=t[i](a),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function V(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var i=t.apply(e,r);function a(t){Y(i,n,o,a,s,"next",t)}function s(t){Y(i,n,o,a,s,"throw",t)}a(void 0)}))}}function Z(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Q(n.key),n)}}function Q(t){var e=function(t){if("object"!=q(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=q(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==q(e)?e:e+""}const $=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.view=e,this.model=r,this.view.bindRegister(this.handleRegister.bind(this)),this.view.bindLogin(this.handleLogin.bind(this)),this.view.bindAddStory(this.handleAddStory.bind(this)),this.view.bindLoadStories(this.handleLoadStories.bind(this)),this.view.bindTakePhoto(),this.view.bindHashChange(this.handleRoute.bind(this)),this.view.bindFetchStoryDetail(this.handleFetchStoryDetail.bind(this)),this.view.bindDeleteOfflineStory(this.handleDeleteOfflineStory.bind(this)),this.view.bindLogout(this.handleLogout.bind(this)),this.view.initMap(),this.setupOfflineHandling()},e=[{key:"setupOfflineHandling",value:function(){var t=this;window.addEventListener("online",(function(){t.view.showFeedback("Koneksi internet kembali pulih","success"),t.handleLoadStories()})),window.addEventListener("offline",(function(){t.view.showFeedback("Anda sedang offline. Menampilkan data terakhir yang tersimpan.","warning"),t.loadOfflineStories()}))}},{key:"handleRegister",value:(u=V(J().mark((function t(e,r,n){var o;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(""===e.trim()||""===r.trim()||n.length<8)){t.next=3;break}return this.view.showFeedback("Pastikan semua field diisi dengan benar dan password minimal 8 karakter.","error"),t.abrupt("return");case 3:return t.prev=3,this.view.showLoading(!0),t.next=7,this.model.register(e,r,n);case 7:o=t.sent,this.view.showFeedback(o.message,o.error?"error":"success"),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(3),this.view.showFeedback(this.getErrorMessage(t.t0,"registrasi"),"error");case 14:return t.prev=14,this.view.showLoading(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[3,11,14,17]])}))),function(t,e,r){return u.apply(this,arguments)})},{key:"handleLogin",value:(c=V(J().mark((function t(e,r){var n;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(""!==e.trim()&&""!==r.trim()){t.next=3;break}return this.view.showFeedback("Email dan password tidak boleh kosong.","error"),t.abrupt("return");case 3:return t.prev=3,this.view.showLoading(!0),t.next=7,this.model.login(e,r);case 7:(n=t.sent).error?this.view.showFeedback("Login gagal: "+n.message,"error"):(this.view.showFeedback("Login berhasil! Selamat datang, ".concat(n.loginResult.name),"success"),K(n.loginResult.token),window.location.hash="#stories"),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(3),this.view.showFeedback(this.getErrorMessage(t.t0,"login"),"error");case 14:return t.prev=14,this.view.showLoading(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[3,11,14,17]])}))),function(t,e){return c.apply(this,arguments)})},{key:"handleAddStory",value:(s=V(J().mark((function t(e,r,n,o){var i;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n&&o){t.next=3;break}return this.view.showFeedback("Silakan pilih lokasi di peta.","error"),t.abrupt("return");case 3:return t.prev=3,this.view.showLoading(!0),t.next=7,this.model.addStory(e,r,n,o);case 7:(i=t.sent).error?this.view.showFeedback(i.message,"error"):(this.view.showFeedback(i.message,"success"),this.view.resetAddStoryForm(),this.handleLoadStories(1,10,0)),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(3),this.view.showFeedback(this.getErrorMessage(t.t0,"menambahkan cerita"),"error");case 14:return t.prev=14,this.view.showLoading(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,this,[[3,11,14,17]])}))),function(t,e,r,n){return s.apply(this,arguments)})},{key:"handleLoadStories",value:(a=V(J().mark((function t(){var e,r,n,o,i=arguments;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=i.length>0&&void 0!==i[0]?i[0]:1,r=i.length>1&&void 0!==i[1]?i[1]:10,n=i.length>2&&void 0!==i[2]?i[2]:0,t.prev=3,this.view.showLoading(!0),t.next=7,this.model.getStories(e,r,n);case 7:(o=t.sent).error?this.view.showFeedback("Gagal memuat cerita: "+o.message,"error"):(this.view.displayStories(this.model.stories),o.fromCache&&this.view.showFeedback(o.message,"warning")),t.next=15;break;case 11:t.prev=11,t.t0=t.catch(3),this.view.showFeedback(this.getErrorMessage(t.t0,"memuat cerita"),"error"),this.view.displayStories([]);case 15:return t.prev=15,this.view.showLoading(!1),t.finish(15);case 18:case"end":return t.stop()}}),t,this,[[3,11,15,18]])}))),function(){return a.apply(this,arguments)})},{key:"handleRoute",value:(i=V(J().mark((function t(){var e,r=this;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=window.location.hash;try{document.startViewTransition(V(J().mark((function t(){return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("#stories"!==e&&"#storySection"!==e){t.next=11;break}return t.next=3,r.view.fadeOut(r.view.authSection);case 3:return r.view.authSection.style.display="none",r.view.storySection.style.display="block",t.next=7,r.view.fadeIn(r.view.storySection);case 7:return t.next=9,r.handleLoadStories();case 9:t.next=22;break;case 11:if("#logout"!==e){t.next=16;break}r.logout(),window.location.hash="#login",t.next=22;break;case 16:return t.next=18,r.view.fadeOut(r.view.storySection);case 18:return r.view.storySection.style.display="none",r.view.authSection.style.display="block",t.next=22,r.view.fadeIn(r.view.authSection);case 22:case"end":return t.stop()}}),t)}))))}catch(t){console.error("Navigation error:",t)}case 2:case"end":return t.stop()}}),t)}))),function(){return i.apply(this,arguments)})},{key:"handleFetchStoryDetail",value:(o=V(J().mark((function t(e){var r;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.view.showLoading(!0),t.next=4,this.model.getStoryDetail(e);case 4:(r=t.sent).error?this.view.showFeedback("Gagal memuat detail cerita: "+r.message,"error"):(this.view.showStoryDetail(r.story),r.fromCache&&this.view.showFeedback(r.message,"warning")),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),this.view.showFeedback(this.getErrorMessage(t.t0,"memuat detail cerita"),"error");case 11:return t.prev=11,this.view.showLoading(!1),t.finish(11);case 14:case"end":return t.stop()}}),t,this,[[0,8,11,14]])}))),function(t){return o.apply(this,arguments)})},{key:"loadOfflineStories",value:(n=V(J().mark((function t(){var e;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.model.getOfflineStories();case 3:e=t.sent,this.view.displayStories(e),this.view.showFeedback("Menampilkan cerita dari cache offline.","info"),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),this.view.showFeedback("Gagal memuat cerita offline: "+t.t0.message,"error");case 11:case"end":return t.stop()}}),t,this,[[0,8]])}))),function(){return n.apply(this,arguments)})},{key:"handleDeleteOfflineStory",value:(r=V(J().mark((function t(e,r){var n,o;return J().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.model.deleteOneStoryFromCache(e,r);case 3:if(!(n=t.sent).success){t.next=13;break}return this.view.showFeedback(n.message,"success"),this.view.removeStoryFromDisplay(r),t.next=9,this.model.getOfflineStories();case 9:o=t.sent,this.view.displayStories(o),t.next=14;break;case 13:this.view.showFeedback(n.message,"error");case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(0),this.view.showErrorMessage("Gagal menghapus cerita offline: ".concat(t.t0.message));case 19:case"end":return t.stop()}}),t,this,[[0,16]])}))),function(t,e){return r.apply(this,arguments)})},{key:"getErrorMessage",value:function(t,e){return t.message.includes("offline")?"Tidak dapat ".concat(e," saat offline. Silakan coba lagi ketika terhubung ke internet."):"Terjadi kesalahan saat ".concat(e,": ").concat(t.message)}},{key:"logout",value:function(){localStorage.removeItem("token"),this.view.showFeedback("Berhasil logout.","success"),this.view.showAuthSection()}},{key:"handleLogout",value:function(){this.logout(),window.location.hash="#login"}}],e&&Z(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,n,o,i,a,s,c,u}();document.addEventListener("DOMContentLoaded",(function(){var t=new S,e=new _,r=new $(e,t);e.setPresenter(r),e.showSection("auth"),window.view=e,"stories"===new URLSearchParams(window.location.search).get("goto")&&e.showSection("stories"),"serviceWorker"in navigator&&navigator.serviceWorker.register("/Sapa-STORIA/sw.js").then((function(t){console.log("Service Worker berhasil didaftarkan:",t)})).catch((function(t){console.error("Service Worker gagal didaftarkan:",t)}))}))})();